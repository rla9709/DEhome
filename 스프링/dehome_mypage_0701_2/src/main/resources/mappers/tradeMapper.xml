<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappers.tradeMapper">
<!-- 물품등록 -->
<insert id="register_goods">
	insert into usedtrade(user_nick
						, category
						, trade_title
						, trade_content
						, trade_date
						, trade_count
						, trade_price
						, trade_evalue
						, trade_photo
						, trade_complete
						, trade_thumb)
	 		values(#{tr_user_nick}
	 				, #{tr_category}
	 				, #{tr_title}
	 				, #{tr_content}
	 				, now()
	 				, 0
	 				, #{tr_price}
	 				, 0
	 				, #{tr_photo}
	 				, 0
	 				, #{tr_thumb}
	 		)
</insert>

<!-- 중고거래 리스트(메인화면) -->
<select id="tradeList" resultType="TradeDTO" parameterType="TradeDTO" >
	select t1.trade_no
		, t1.USER_NICK as tr_user_nick
		, t1.category as tr_category
		, t1.TRADE_TITLE as tr_title
		, t1.TRADE_CONTENT as tr_content
		, t1.TRADE_DATE as tr_date
		, t1.TRADE_COUNT as tr_count
		, t1.TRADE_EVALUE as tr_evalue
		, format(t1.TRADE_PRICE,0) as tr_price
		, t1.TRADE_PHOTO as tr_photo
		, t1.TRADE_COMPLETE as tr_complete
		, case when left(t2.user_addr2,1) = '경' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '전' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '충' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '강' then substring_index(t2.user_addr2,' ', 3) 
				else substring_index(t2.user_addr2,' ', 2) 
			end as user_addr2
		from usedtrade t1, user t2 
		where t1.user_nick = t2.user_nick and trade_complete = 0 order by trade_no desc
		limit 0, 9
</select>
<!-- 중고거래 리스트(메인화면) 더보기 -->
<select id="tradeListMore" resultType="TradeDTO" parameterType="TradeDTO" >
	select t1.trade_no
		, t1.USER_NICK as tr_user_nick
		, t1.category as tr_category
		, t1.TRADE_TITLE as tr_title
		, t1.TRADE_CONTENT as tr_content
		, t1.TRADE_DATE as tr_date
		, t1.TRADE_COUNT as tr_count
		, t1.TRADE_EVALUE as tr_evalue
		, format(t1.TRADE_PRICE,0) as tr_price
		, t1.TRADE_PHOTO as tr_photo
		, t1.TRADE_COMPLETE as tr_complete
		, case when left(t2.user_addr2,1) = '경' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '전' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '충' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '강' then substring_index(t2.user_addr2,' ', 3) 
				else substring_index(t2.user_addr2,' ', 2) 
			end as user_addr2
		from usedtrade t1, user t2 
		where t1.user_nick = t2.user_nick and trade_complete = 0 order by trade_no desc
		limit #{startPage}, 3
</select>

<!-- 중고거래 리스트(메인화면)카테고리 -->
<select id="tradeListCategory" resultType="TradeDTO" parameterType="TradeDTO" >
	select t1.trade_no
		, t1.USER_NICK as tr_user_nick
		, t1.category as tr_category
		, t1.TRADE_TITLE as tr_title
		, t1.TRADE_CONTENT as tr_content
		, t1.TRADE_DATE as tr_date
		, t1.TRADE_COUNT as tr_count
		, t1.TRADE_EVALUE as tr_evalue
		, format(t1.TRADE_PRICE,0) as tr_price
		, t1.TRADE_PHOTO as tr_photo
		, t1.TRADE_COMPLETE as tr_complete
		, case when left(t2.user_addr2,1) = '경' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '전' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '충' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '강' then substring_index(t2.user_addr2,' ', 3) 
				else substring_index(t2.user_addr2,' ', 2) 
			end as user_addr2
		from usedtrade t1, user t2 
		where t1.user_nick = t2.user_nick and trade_complete = 0 and category = #{category}
		order by trade_no desc
		limit 0, 9
</select>

<!-- 중고거래 리스트(메인화면)카테고리별 더보기 -->
<select id="tradeListCategoryMore" resultType="TradeDTO" parameterType="TradeDTO" >
	select t1.trade_no
		, t1.USER_NICK as tr_user_nick
		, t1.category as tr_category
		, t1.TRADE_TITLE as tr_title
		, t1.TRADE_CONTENT as tr_content
		, t1.TRADE_DATE as tr_date
		, t1.TRADE_COUNT as tr_count
		, t1.TRADE_EVALUE as tr_evalue
		, format(t1.TRADE_PRICE,0) as tr_price
		, t1.TRADE_PHOTO as tr_photo
		, t1.TRADE_COMPLETE as tr_complete
		, case when left(t2.user_addr2,1) = '경' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '전' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '충' then substring_index(t2.user_addr2,' ', 3) 
				when left(t2.user_addr2,1) = '강' then substring_index(t2.user_addr2,' ', 3) 
				else substring_index(t2.user_addr2,' ', 2) 
			end as user_addr2
		from usedtrade t1, user t2 
		where t1.user_nick = t2.user_nick and trade_complete = 0 and category = #{category}
		order by trade_no desc
		limit #{startPage}, 3
</select>

<!-- 동네 검색했을때 리스트 출력 -->
<select id="tradeList_search" resultType="TradeDTO" parameterType="TradeDTO">
select t1.trade_no
	, t1.USER_NICK as tr_user_nick
	, t1.category as tr_category
	, t1.TRADE_TITLE as tr_title
	, t1.TRADE_CONTENT as tr_content
	, t1.TRADE_DATE as tr_date
	, t1.TRADE_COUNT as tr_count
	, t1.TRADE_EVALUE as tr_evalue
	, format(t1.TRADE_PRICE,0) as tr_price
	, t1.TRADE_PHOTO as tr_photo
	, t1.TRADE_COMPLETE as tr_complete
	, case when left(t2.user_addr2,1) = '경' then substring_index(t2.user_addr2,' ', 3) 
			when left(t2.user_addr2,1) = '전' then substring_index(t2.user_addr2,' ', 3) 
			when left(t2.user_addr2,1) = '충' then substring_index(t2.user_addr2,' ', 3) 
			when left(t2.user_addr2,1) = '강' then substring_index(t2.user_addr2,' ', 3) 
	else substring_index(t2.user_addr2,' ', 2) 
	end as user_addr2
	from usedtrade t1, user t2 
	where t1.user_nick = t2.user_nick and trade_complete = 0 and t2.user_addr2 like concat('%',#{search_area},'%') 
	order by trade_no desc
</select>

</mapper>









